<app-header-with-back-handler title={{DetailsFormTitle}}></app-header-with-back-handler>
<ion-content class="form-container" scrollY="true" [scrollEvents]="true" [fullscreen]="true">
  <ion-list lines="none" class="ion-padding">
    <!--  Date -->
    <ion-item class="input-item">
      <ion-label>Select Date</ion-label>
      <ion-datetime-button id="ExpenseDate-trigger" datetime="ExpenseDate"></ion-datetime-button>

      <ion-checkbox slot="end" [(ngModel)]="ExpenseDate" name="ExpenseDateCheckBox" [disabled]="true"></ion-checkbox>
    </ion-item>
    <ion-modal keepContentsMounted="true" trigger="ExpenseDate-trigger">
      <ng-template>
        <ion-datetime id="ExpenseDate" presentation="date" [(ngModel)]="ExpenseDate" show-default-buttons="true"
          (ionChange)="onExpenseDateChange($event.detail.value)">
        </ion-datetime>
      </ng-template>
    </ion-modal>

    <!-- Select site -->
    <ion-item class="input-item" button detail (click)="selectSiteBottomsheet()" [disabled]="SiteList.length===0">
      <ion-label>Site</ion-label>

      <!-- Text showing the selected status -->
      <ion-text slot="end" class="status-text">
        {{ SiteName|| 'Select' }}
      </ion-text>
    </ion-item>

    <!-- Select Ledger -->
    <ion-item class="input-item" button detail (click)="selectLedgerBottomsheet()" [disabled]="LedgerList.length===0">
      <ion-label>Ledger</ion-label>

      <!-- Text showing the selected status -->
      <ion-text slot="end" class="status-text">
        {{ LedgerName|| 'Select' }}
      </ion-text>
    </ion-item>

    <!-- Select Sub Ledger -->
    <ion-item class="input-item" button detail (click)="selectSubLedgerBottomsheet()"
      [disabled]="SubLedgerList.length===0">
      <ion-label>Sub Ledger</ion-label>

      <!-- Text showing the selected status -->
      <ion-text slot="end" class="status-text">
        {{ SubLedgerName|| 'Select' }}
      </ion-text>
    </ion-item>

    <!-- Select To Whom Type -->
    <ion-item class="input-item" button detail (click)="selectToWhomTypeBottomsheet()"
      [disabled]="RecipientTypesList.length===0">
      <ion-label>To Whom Types</ion-label>

      <!-- Text showing the selected status -->
      <ion-text slot="end" class="status-text">
        {{ ToWhomTypeName|| 'Select' }}
      </ion-text>
    </ion-item>

    <!-- Recipient Selection (Dropdown Mode) -->
    <!-- <ion-item class="input-item" *ngIf="!RecipientNameInput">
          <ion-label (click)="selectRecipientNameBottomsheet()">To Whom</ion-label> -->

    <!-- Display selected recipient name -->
    <!-- <ion-text slot="end" class="status-text" (click)="selectRecipientNameBottomsheet()">
            {{ RecipientName || 'Select' }}
          </ion-text> -->

    <!-- Optional Add button -->
    <!-- <ion-button slot="end" fill="solid" size="small" (click)="AddRecipientName()"
            style="--background: var(--ion-color-primary); --border-radius: 8px; margin-left: 6px;"
            *ngIf="Entity.p.RecipientType === payerTypeRecipient">
            <ion-icon slot="icon-only" name="add-outline" color="light"></ion-icon>
          </ion-button>
        </ion-item> -->

    <!-- Manual Entry Mode (RecipientNameInput = true) -->
    <!-- <ion-grid *ngIf="RecipientNameInput">
          <ion-row class="ion-align-items-center ion-justify-content-between" style="gap: 8px;">
            <ion-col size="12">
              <ion-item class="input-item">
                <ion-input label="To Whom Name" labelPlacement="floating" placeholder="Enter To Whom Name"
                  [(ngModel)]="RecipientEntity.p.Name" required>
                </ion-input>
              </ion-item>
            </ion-col>
          </ion-row> -->

    <!-- <ion-row class="ion-align-items-center ion-justify-content-between" style="gap: 8px;"> -->
    <!-- Cancel -->
    <!-- <ion-col size="4">
              <ion-button expand="block" fill="solid" size="small" (click)="cancelRecipientName()"
                style="--background: var(--ion-color-medium); --border-radius: 8px;">
                <ion-icon slot="icon-only" name="close-outline" color="light"></ion-icon>
              </ion-button>
            </ion-col> -->

    <!-- Confirm -->
    <!-- <ion-col size="4">
              <ion-button expand="block" fill="solid" size="small" (click)="SaveNewRecipientName()"
                style="--background: var(--ion-color-primary); --border-radius: 8px;">
                <ion-icon slot="icon-only" name="checkmark-outline" color="light"></ion-icon>
              </ion-button>
            </ion-col>
          </ion-row>
        </ion-grid> -->
    <!-- Recipient Selection (Dropdown Mode via Bottomsheet) -->
    <ion-item class="input-item" *ngIf="!RecipientNameInput">
      <ion-label (click)="selectRecipientNameBottomsheet()">To Whom</ion-label>

      <!-- Selected recipient -->
      <ion-text slot="end" class="status-text" (click)="selectRecipientNameBottomsheet()">
        {{ RecipientName || 'Select' }}
      </ion-text>

      <!-- Add button (only when RecipientType = payerTypeRecipient) -->
      <ion-button slot="end" fill="solid" size="small" (click)="AddRecipientName()"
        style="--background: var(--ion-color-primary); --border-radius: 8px; margin-left: 6px;"
        *ngIf="Entity.p.RecipientType === payerTypeRecipient">
        <ion-icon slot="icon-only" name="add-outline" color="light"></ion-icon>
      </ion-button>
    </ion-item>

    <!-- Manual Entry Mode -->
    <ion-grid *ngIf="RecipientNameInput">
      <ion-row>
        <ion-col size="12">
          <ion-item class="input-item">
            <ion-input label="To Whom Name" labelPlacement="floating" placeholder="Enter To Whom Name"
              [(ngModel)]="RecipientEntity.p.Name" required>
            </ion-input>
          </ion-item>
        </ion-col>
      </ion-row>

      <ion-row class="ion-align-items-center ion-justify-content-between" style="gap: 8px;">
        <!-- Cancel -->
        <ion-col size="6">
          <ion-button expand="block" fill="solid" size="small" (click)="cancelRecipientName()"
            style="--background: var(--ion-color-medium); --border-radius: 8px;">
            <ion-icon slot="icon-only" name="close-outline" color="light"></ion-icon>
          </ion-button>
        </ion-col>

        <!-- Confirm -->
        <ion-col size="6">
          <ion-button expand="block" fill="solid" size="small" (click)="SaveNewRecipientName()"
            style="--background: var(--ion-color-primary); --border-radius: 8px;">
            <ion-icon slot="icon-only" name="checkmark-outline" color="light"></ion-icon>
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Payment Type -->
    <ion-item class="input-item" button detail (click)="selectPaymentTypeBottomsheet()"
      *ngIf="this.Entity.p.RecipientType == Employee " [disabled]="TypeofEmployeePaymentList.length===0">
      <ion-label>Payment Type</ion-label>

      <!-- Text showing the selected status -->
      <ion-text slot="end" class="status-text">
        {{ PaymentTypeName|| 'Select' }}
      </ion-text>
    </ion-item>

    <!-- Reason -->
    <ion-item class="input-item">
      <ion-input label="Reason" labelPlacement="floating" placeholder="Enter Reason" [(ngModel)]="Entity.p.Reason"
        clearInput="true"></ion-input>
    </ion-item>
    <!-- mode of payment -->
    <ion-item class="input-item" button detail (click)="selectModeOfPaymentBottomsheet()"
      [disabled]="ModeofPaymentList.length===0">
      <ion-label>Mode of Payment</ion-label>

      <!-- Text showing the selected status -->
      <ion-text slot="end" class="status-text">
        {{ ModeOfPaymentName|| 'Select' }}
      </ion-text>
    </ion-item>

    <!-- Bank -->
    <ion-item class="input-item" button (click)="selectBankBottomsheet()"
      *ngIf="Entity.p.ExpenseModeOfPayment != Cash && Entity.p.ExpenseModeOfPayment" [disabled]="BankList.length==0">
      <ion-label>Bank</ion-label>

      <!-- Text showing the selected status -->
      <ion-text slot="end" class="status-text">
        {{ BankName|| 'Select' }}
      </ion-text>
    </ion-item>

    <!-- Plot Name -->
    <ion-item class="input-item" *ngIf="Entity.p.RecipientType == DealDoneCustomer && Entity.p.RecipientRef != 0">
      <ion-input label="Plot Name" labelPlacement="floating" placeholder="Enter Plot Name"
        [(ngModel)]="Entity.p.PlotName" clearInput="true" [disabled]="'true'"></ion-input>
    </ion-item>

    <!-- Select Income Ledger -->
    <ion-item class="input-item" button detail (click)="selectIncomeLedgerBottomsheet()"
      *ngIf="this.Entity.p.RecipientType == Sites" [disabled]="LedgerList.length==0">
      <ion-label>Income Ledger</ion-label>

      <!-- Text showing the selected status -->
      <ion-text slot="end" class="status-text">
        {{ IncomeLedgerName|| 'Select' }}
      </ion-text>
    </ion-item>

    <!-- Select SubIncome Ledger -->
    <ion-item class="input-item" button detail (click)="selectIncomeSubLedgerBottomsheet()"
      *ngIf="this.Entity.p.RecipientType == Sites" [disabled]="IncomeSubLedgerList.length==0">
      <ion-label>Income SubLedger</ion-label>

      <!-- Text showing the selected status -->
      <ion-text slot="end" class="status-text">
        {{ IncomeSubLedgerName|| 'Select' }}
      </ion-text>
    </ion-item>

    <!-- Balance Advance -->
    <ion-item class="input-item" *ngIf="this.Entity.p.RecipientType == Employee && this.Entity.p.IsSalaryExpense">
      <ion-input label="Balance Advance Amount" labelPlacement="floating" placeholder="Enter Balance Advance Amount"
        [(ngModel)]="Entity.p.RemainingAdvance" clearInput="true"></ion-input>
    </ion-item>

    <!-- Amount -->
    <ion-item class="input-item" *ngIf="!Entity.p.IsAdvancePayment">
      <ion-input
        [label]="(Entity.p.RecipientType == EmployeeType && !Entity.p.IsSalaryExpense)?'Bill Amount':(Entity.p.RecipientType == EmployeeType &&  Entity.p.IsSalaryExpense)?'Net Salary':(Entity.p.RecipientType != EmployeeType)?'Bill Amount':'expenese Amount'"
        labelPlacement="floating" placeholder="Enter Expense Amount" [(ngModel)]="Entity.p.InvoiceAmount"
        (ngModelChange)="Entity.p.GivenAmount = 0; Entity.p.DiscountAmount = 0" type="number" clearOnEdit="true"
        clearInput="true"></ion-input>
    </ion-item>

    <!-- Discount Amount -->
    <ion-item class="input-item">
      <ion-input label="Discount Amount" labelPlacement="floating" placeholder="Enter Discount Amount"
        [(ngModel)]="Entity.p.DiscountAmount"
        (ngModelChange)="IsDiscountEditing = true; CalculateRemainingAmountandBalance()" type="number"
        clearOnEdit="true" clearInput="true"></ion-input>
    </ion-item>

    <!-- Given Amount -->
    <ion-item class="input-item">
      <ion-input label="Given Amount" labelPlacement="floating" placeholder="Enter Given Amount"
        [(ngModel)]="Entity.p.GivenAmount"
        (ngModelChange)="IsDiscountEditing = true; CalculateRemainingAmountandBalance()" type="number"
        clearOnEdit="true" clearInput="true"></ion-input>
    </ion-item>

    <!-- Remaining Amount -->
    <ion-item class="input-item" *ngIf="!Entity.p.IsAdvancePayment">
      <ion-input label="Remaining Amount" labelPlacement="floating" placeholder="Enter Remaining Amount"
        [(ngModel)]="Entity.p.RemainingAmount" [disabled]="'true'"></ion-input>
    </ion-item>

    <!-- Shree Balance -->
    <ion-item class="input-item">
      <ion-input label="Shree Balance" labelPlacement="floating" placeholder="Enter Shree Balance"
        [(ngModel)]="Entity.p.ShreesBalance" [disabled]="'true'"></ion-input>
    </ion-item>

    <!-- Narration -->
    <ion-item class="input-item">
      <ion-input label="Narration" labelPlacement="floating" placeholder="Enter Narration"
        [(ngModel)]="Entity.p.Narration" clearInput="true" clearOnEdit="true"></ion-input>
    </ion-item>

    <!-- mode of payment for Income -->
    <ion-item class="input-item" button detail (click)="selectModeOfPaymentForIncomeBottomsheet()"
      [disabled]="ModeofPaymentList.length===0" *ngIf="this.Entity.p.RecipientType == Sites">
      <ion-label>Mode of Payment</ion-label>

      <!-- Text showing the selected status -->
      <ion-text slot="end" class="status-text">
        {{ ModeOfPaymentNameForIncome|| 'Select' }}
      </ion-text>
    </ion-item>

    <!-- New Bank Created -->
    <ion-checkbox class="input-item" [(ngModel)]="Entity.p.IsNewBankCreated"
      *ngIf="this.Entity.p.RecipientType == Sites && Entity.p.ModeOfPaymentForIncome != Cash && Entity.p.ModeOfPaymentForIncome">New
      Bank Created</ion-checkbox>

    <!-- Bank -->
    <ion-item class="input-item" button (click)="selectBankBottomsheetForIncome()"
      *ngIf="(Entity.p.ModeOfPaymentForIncome != Cash && Entity.p.ModeOfPaymentForIncome) && Entity.p.IsNewBankCreated"
      [disabled]="IncomeBankList.length==0">
      <ion-label>Bank</ion-label>

      <!-- Text showing the selected status -->
      <ion-text slot="end" class="status-text">
        {{ BankNameForIncome|| 'Select' }}
      </ion-text>
    </ion-item>

    <!-- Bank -->
    <ion-item class="input-item" button (click)="selectBankBottomsheetNewBank()"
      *ngIf="(Entity.p.ModeOfPaymentForIncome != Cash && Entity.p.ModeOfPaymentForIncome) && !Entity.p.IsNewBankCreated"
      [disabled]="BankList.length==0">
      <ion-label>Bank</ion-label>

      <!-- Text showing the selected status -->
      <ion-text slot="end" class="status-text">
        {{ BankNameForNewBank|| 'Select' }}
      </ion-text>
    </ion-item>

    <!-- Reason -->
    <ion-item class="input-item" *ngIf="this.Entity.p.RecipientType == Sites">
      <ion-input label="Reason" labelPlacement="floating" placeholder="Enter Reason"
        [(ngModel)]="Entity.p.ReasonForIncome" clearInput="true" clearOnEdit="true"></ion-input>
    </ion-item>

    <ion-checkbox class="input-item" [(ngModel)]="Entity.p.IsAutoInvoiceEnabled">Invoice Auto generate</ion-checkbox>

    <!-- Main Buttons -->
    <ion-grid>
      <ion-row>
        <ion-col size="6">
          <ion-button expand="block" color="medium" shape="round" (click)="goBack()">
            Cancel
          </ion-button>
        </ion-col>
        <ion-col size="6">
          <ion-button expand="block" color="primary" shape="round" (click)="SaveExpense()">
            Save
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-list>
</ion-content>