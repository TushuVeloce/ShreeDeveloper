<div class="row">
  <div class="col-4 mb-2">
    <h1 style="padding-top: 3px;" class="title title_light">Customer Info</h1>
  </div>
  <ng-template #noDataTpl>
    <div style="text-align: center; color: rgba(0, 0, 0, 0.25);">
      No Data
    </div>
  </ng-template>
  <div class="col-4 mb-2 search-container_light">
    <app-shared-filter [masterList]="MasterList"
      [filterFields]="['CustID','CustomerName', 'CustomerAddress', 'ContactNos', 'PANNo', 'AdharNo', 'LeadSourceName', 'BookingRemarkName', 'PlotNo']"
      (filteredList)="onFilteredList($event)"></app-shared-filter>
  </div>
  <div class="col-4 mb-2 text-end" *ngIf="DisplayMasterList.length > 0">
    <img class="no-print" src="/assets/icons/printer.png" alt="Print" title="Print" width="30px" height="30px"
      style="cursor: pointer; padding-top: 4px;" (click)="printReport()" />
  </div>
</div>
<div class="card-body">
  <form autocomplete="off">
    <div class="row row-cols-1 row-cols-md-4 g-2 filter-row">
      <div class="col">
        <label for="SiteRef"><b>Site</b></label>
        <nz-select class="nzSelect-light" [nzNotFoundContent]="noDataTpl" nzShowSearch nzAllowClear
          nzPlaceHolder="Select" id="SiteRef" name="SiteRef" [nzSize]="'large'" [(ngModel)]="SiteRef"
          (ngModelChange)="getCustomerReportByCompanyAndSiteRef()">
          <nz-option [nzValue]="0" [nzLabel]="'All'"></nz-option>
          <nz-option *ngFor="let site of SiteList" [nzValue]="site.p.Ref" [nzLabel]="site.p.Name"></nz-option>
        </nz-select>
      </div>
    </div>
  </form>

  <div class="table-wrapper tblcard_light" *ngIf="DisplayMasterList.length > 0">
    <div class="table-container">
      <nz-table #basicTable nzSize="small" class="no-hover-table bgtable_light" [nzScroll]="{x:'auto' }"
        nzFrontPagination="false" [nzShowSizeChanger]="false" [nzData]="paginatedList()"
        (nzPageIndexChange)="onPageChange($event)">
        <thead>
          <tr>
            <th *ngFor="let header of headers" class="tblheader">{{ header }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let customer of paginatedList(); index as i">
            <td Class="tbldata">{{ (currentPage - 1) * pageSize + i + 1 }}</td>
            <td Class="tbldata">{{customer.p.CustID ? customer.p.CustID : '--'}}</td>
            <td Class="tbldata">{{customer.p.CustomerName}}</td>
            <td Class="tbldata">{{customer.p.CustomerAddress}}</td>
            <td Class="tbldata">{{customer.p.ContactNos}}</td>
            <td Class="tbldata">{{customer.p.PANNo ? customer.p.PANNo : '--'}}</td>
            <td Class="tbldata">{{customer.p.AdharNo ? customer.p.AdharNo : '--'}}</td>
            <td Class="tbldata">{{customer.p.LeadSourceName}}</td>
            <td Class="tbldata">{{customer.p.LeadHandleByName}}</td>
            <td Class="tbldata">{{customer.p.BrokerName ? customer.p.BrokerName : '--'}}</td>
            <td Class="tbldata">{{customer.p.RegisterCustomerBookingRemarkName ?
              customer.p.RegisterCustomerBookingRemarkName : '--'}}</td>
            <td Class="tbldata">{{customer.p.PlotNo}}</td>
            <td Class="tbldata">{{customer.p.AreaInSqm}}</td>
            <td Class="tbldata">{{customer.p.AreaInSqft}}</td>
            <td Class="tbldata">{{customer.p.BasicRate | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.DiscountedRateOnArea | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.DiscountOnTotalPlotAmount | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.TotalPlotAmount | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.GovernmentRecknor | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.GovernmentValue | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.ValueOfAgreement | currency : "INR"}}</td>
            <td Class="tbldata">1%</td>
            <td Class="tbldata">{{customer.p.RegistrationFees}}</td>
            <td Class="tbldata">{{customer.p.TaxValueInPercentage }}%</td>
            <td Class="tbldata">{{customer.p.StampDuties | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.GoodsServicesTax }}%</td>
            <td Class="tbldata">{{customer.p.LegalCharges | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.TotalExtraCharges | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.GrandTotal | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.TotalChequeReceived | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.TotalCashReceived | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.TotalAmountReceived | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.TotalChequeBalance | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.TotalCashBalance | currency : "INR"}}</td>
            <td Class="tbldata">{{customer.p.TotalBalance | currency : "INR"}}</td>
          </tr>
          <tr>
            <td class="tbldata"><b>Total Amount</b></td>
            <td class="tbldata" colspan="11"></td>
            <td class="tbldata">
              <b>{{ getTotalAreaInSqm() }}</b>
            </td>
            <td class="tbldata">
              <b>{{ getTotalAreaInSqft() }}</b>
            </td>
            <td class="tbldata" colspan="3"></td>
            <td class="tbldata">
              <b>{{ getTotalPlotAmount() | currency : "INR" }}</b>
            </td>
            <td class="tbldata"></td>
            <td class="tbldata">
              <b>{{ getTotalGovernmentValue() | currency : "INR" }}</b>
            </td>
            <td class="tbldata">
              <b>{{ getTotalValueOfAgreement() | currency : "INR" }}</b>
            </td>
            <td class="tbldata"></td>
            <td class="tbldata">
              <b>{{ getTotalRegistrationFees() | currency : "INR" }}</b>
            </td>
            <td class="tbldata"></td>
            <td class="tbldata">
              <b>{{ getTotalStampDuties() | currency : "INR" }}</b>
            </td>
            <td class="tbldata"></td>
            <td class="tbldata">
              <b>{{ getTotalLegalCharges() | currency : "INR" }}</b>
            </td>
            <td class="tbldata">
              <b>{{ getTotalExtraCharges() | currency : "INR" }}</b>
            </td>
            <td class="tbldata">
              <b>{{ getTotalGrandTotal() | currency : "INR" }}</b>
            </td>
            <td Class="tbldata">
              <b>{{getTotalChequeReceived() | currency : "INR"}}</b>
            </td>
            <td Class="tbldata">
              <b>{{getTotalCashReceived() | currency : "INR"}}</b>
            </td>
            <td Class="tbldata">
              <b>{{getTotalAmountReceived() | currency : "INR"}}</b>
            </td>
            <td Class="tbldata">
              <b>{{getTotalChequeBalance() | currency : "INR"}}</b>
            </td>
            <td Class="tbldata">
              <b>{{getTotalCashBalance() | currency : "INR"}}</b>
            </td>
            <td Class="tbldata">
              <b>{{getTotalBalance() | currency : "INR"}}</b>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </div>
  <div class="fixed-pagination">
    <nz-pagination class="try light-theme" [nzPageSize]="pageSize" [nzTotal]="total" [(nzPageIndex)]="currentPage"
      (nzPageIndexChange)="onPageChange($event)" [nzShowSizeChanger]="false" [nzResponsive]="true">
    </nz-pagination>
  </div>
  <div *ngIf="DisplayMasterList.length === 0">
    <div style="height: 200px;" class="d-flex align-items-center justify-content-center">
      <span Class="title_light"> Data Not Found</span>
    </div>
  </div>





  <!-- Print Section with automatic page breaks -->
  <div id="print-section" style="display: none;" #PrintContainer>
    <h2 style="text-align: center; margin-bottom: 1rem;">Customer Info Report</h2>
    <table class="table table-bordered print-table" style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="background-color: maroon; color: white;">#</th>
          <th *ngFor="let header of headers.slice(1)" style="background-color: maroon; color: white;">
            {{ header }}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of DisplayMasterList; let i = index">
          <td class="tbldata">{{ i + 1 }}</td>
          <td class="tbldata">{{ item.p.CustID || '-' }}</td>
          <td class="tbldata">{{ item.p.CustomerName || '-' }}</td>
          <td class="tbldata">{{ item.p.CustomerAddress || '-' }}</td>
          <td class="tbldata">{{ item.p.ContactNos || '-' }}</td>
          <td class="tbldata">{{ item.p.PANNo || '-' }}</td>
          <td class="tbldata">{{ item.p.AdharNo || '-' }}</td>
          <td class="tbldata">{{ item.p.LeadSourceName || '-' }}</td>
          <td class="tbldata">{{ item.p.LeadHandleByName || '-' }}</td>
          <td class="tbldata">{{ item.p.BrokerName || '-' }}</td>
          <td class="tbldata">{{ item.p.RegisterCustomerBookingRemarkName || '-' }}</td>
          <td class="tbldata">{{ item.p.PlotNo || '-' }}</td>
          <td class="tbldata">{{ item.p.AreaInSqm || '-' }}</td>
          <td class="tbldata">{{ item.p.AreaInSqft || '-' }}</td>
          <td class="tbldata">{{ (item.p.BasicRate | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.DiscountedRateOnArea | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.DiscountOnTotalPlotAmount | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.TotalPlotAmount | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.GovermentRatePerSqm | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.GovernmentValue | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.ValueOfAgreement | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ item.p.RegTaxValueInPercentage != null ? item.p.RegTaxValueInPercentage + '%' : '-' }}
          </td>
          <td class="tbldata">{{ item.p.TaxValueInPercentage != null ? item.p.TaxValueInPercentage + '%' : '-' }}</td>
          <td class="tbldata">{{ (item.p.StampDuties | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ item.p.GoodsServicesTax != null ? item.p.GoodsServicesTax + '%' : '-' }}</td>
          <td class="tbldata">{{ (item.p.TotalExtraCharges | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.LegalCharges | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.TotalChequeReceived | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.TotalCashReceived | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.TotalAmountReceived | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.TotalChequeBalance | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.TotalCashBalance | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.TotalBalance | currency : 'INR') || '-' }}</td>
          <td class="tbldata">{{ (item.p.GrandTotal | currency : 'INR') || '-' }}</td>
        </tr>
      </tbody>
    </table>
  </div>